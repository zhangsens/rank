/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _data = __webpack_require__(1);

var _draw = __webpack_require__(2);

var _draw2 = _interopRequireDefault(_draw);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// var Conponent = React.createClass({
//     render : function(){
//         return (
//             <div>
//                 <p>rank:</p>
//                 <canvas id="cv" width="1000" height="2000"></canvas>
//             </div>
//         )
//     }
// })

// ReactDOM.render(
//     <Conponent></Conponent>, 
//     document.querySelector("#app")
// );
// import React from "react"
// import ReactDOM from "react-dom"
var cv = document.createElement("canvas");
document.querySelector("#app").appendChild(cv);
cv.width = 1400;
cv.height = 2000;
cv.style.cssTest = "position:relative";
cv.innerText = "\u60A8\u7684\u6D4F\u89C8\u5668\u6682\u4E0D\u652F\u6301\u54E6\u0E51\u4E5B\u25E1\u4E5B\u0E51";

var ctx = cv.getContext("2d");
(0, _data.data)().then(function (value) {
    //这里处理数据
    new _draw2.default(ctx, value);
}, function (value) {
    console.log(value);
});

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
function data() {
    return new Promise(function (resole, reject) {

        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST", "/data", false);
        xmlHttp.send(null);
        if (xmlHttp.responseText) {
            resole(JSON.parse(xmlHttp.responseText));
        } else {
            reject(0);
        }
        // async = true;
        // xmlHttp.onreadystatechange = function() {
        //     if (xmlHttp.status == 200) {
        //         if (xmlHttp.responseText) {
        //             resole(xmlHttp.responseText);
        //         }
        //     } else {
        //         reject("connect error");
        //     }
        // }
    });
}

exports.data = data;

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _drawType = __webpack_require__(3);

var _drawType2 = _interopRequireDefault(_drawType);

var _personalDetail = __webpack_require__(4);

var _personalDetail2 = _interopRequireDefault(_personalDetail);

var _personal = __webpack_require__(5);

var _personal2 = _interopRequireDefault(_personal);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var draw = function draw(ctx, data) {
    this.data = data.result;
    this.data.sort(this.descending("ballot_sum"));
    this.ctx = ctx;
    this.width = this.ctx.canvas.width - 200;
    this.height = this.ctx.canvas.width;
    this.personalDetail = new _personalDetail2.default();;
    this.characters = [];
    console.log(this.data);

    for (var i = 0; i < this.data.length; i++) {
        var x = i * (this.width - 200) / 30 + 100;
        var y = i == 0 ? 100 : (this.data[0].ballot_ratio - this.data[i - 1].ballot_ratio) / 2 + 100;
        var r = 1;
        var color = "hsla(" + i * 360 / this.data.length + ",80%,50%,1)";
        var character = new _personal2.default(this.data[i], x, y, r, color);
        character.nX = this.width;
        character.nY = (i + 1) * 20 + 100;
        character.radioX = this.width + 200 + i * 200;
        this.characters.push(character);
    }

    this.draw();
    new _drawType2.default(this.characters, this.ctx)["test"]();

    this.ctx.canvas.onmousemove = this.mousemove.bind(this);
};

draw.prototype = {
    ascending: function ascending(attr) {
        return function (a, b) {
            return a[attr] - b[attr];
        };
    },
    descending: function descending(attr) {
        return function (a, b) {
            return b[attr] - a[attr];
        };
    },
    chart: function chart() {

        this.ctx.strokeStyle = "hsla(200,80%,60%,1)";
        this.ctx.moveTo(100, 50);
        this.ctx.lineTo(100, 700);
        this.ctx.lineTo(this.width - 50, 700);
        this.ctx.stroke();

        this.ctx.strokeStyle = "hsla(0,0%,0%,0.5)";
        for (var i = 0; i < 6; i++) {
            this.ctx.beginPath();
            this.ctx.lineTo(100, 100 * (i + 1));
            this.ctx.lineTo(this.width - 100, 100 * (i + 1));
            this.ctx.stroke();
        }
        for (var _i = 0; _i < 10; _i++) {
            this.ctx.save();
            this.ctx.beginPath();
            this.ctx.lineTo(100 + (_i + 1) * (this.width - 200) / 10, 100);
            this.ctx.lineTo(100 + (_i + 1) * (this.width - 200) / 10, 700);
            this.ctx.stroke();
            this.ctx.fillStyle = this.characters[_i].color;
            this.ctx.translate(90 + (_i + 1) * 20, 720);
            this.ctx.rotate(Math.PI * 4 / 9);
            //this.ctx.fillText(this.data[i].chn_name, 0, 0);
            this.ctx.restore();
        }
    },
    rang: function rang(s, e) {
        var subtrahend = (e - s) / 6;
        for (var i = 0; i < 7; i++) {
            this.ctx.fillText(e - i * subtrahend, 0, 100 * (i + 1));
        }
    },
    list: function list() {
        for (var i = 0; i < this.characters.length; i++) {
            this.ctx.font = this.characters[i].fontSize + "px Arial";
            this.ctx.fillStyle = this.characters[i].color;
            this.ctx.fillText(this.characters[i].data.chn_name, this.characters[i].nX, this.characters[i].nY);
        }
    },
    //抢老婆广播
    radio: function radio() {
        this.ctx.clearRect(0, 1000, this.width + 200, 200);
        for (var i = 0; i < this.characters.length; i++) {
            this.ctx.fillStyle = "hsla(0,100%,0%,1)";
            this.ctx.fillText(this.characters[i].data.chn_name + ":" + this.characters[i].data.ballot_sum + "\u7968", this.characters[i].radioX, 1100);
            this.ctx.fillText("\u6709" + this.characters[i].data.real_love_num + "\u4EBA\u548C\u4F60\u62A2\u8001\u5A46", this.characters[i].radioX, 1120);
            this.characters[i].radioX--;
            if (this.characters[i].radioX < 0) {
                this.characters[i].radioX = this.data.length * 200;
            }
        }
    },
    draw: function draw() {
        var max = 0,
            pow = 0;
        for (var i = 0, t = 0, v = 0; t < 1; i++) {
            v = this.characters[0].data.ballot_sum / Math.pow(10, i);
            if (v > 10) {
                max = Math.floor(v) * Math.pow(10, i);
                t = 0;
                pow = i;
            } else {
                t = 1;
            }
        }
        max = Math.ceil(max / (6 * Math.pow(10, pow))) * (6 * Math.pow(10, pow));

        this.ctx.clearRect(0, 0, this.width + 200, 900);
        this.chart();
        this.rang(0, max);
        this.list();
        //this.radio();

        new _drawType2.default(this.characters, this.ctx)["rectangle"]("ballot_sum", max);

        requestAnimationFrame(this.draw.bind(this));
    },
    mousemove: function mousemove(e) {

        var offsetX = e.offsetX;
        var offsetY = e.offsetY;
        var hide = true;
        var _src;

        for (var i = 0; i < this.characters.length; i++) {
            if (offsetX > this.characters[i].nX && offsetX < this.characters[i].nX + 200 && offsetY > this.characters[i].nY - 10 && offsetY < this.characters[i].nY) {
                hide = false;
                this.characters[i].fontSize = 15;
                this.personalDetail.show(e);
                _src = this.characters[i].data.cover.substr(5);
                console.log(_src);
                this.personalDetail.personal.innerHTML = "\n                <img src=\"http://mat1.gtimg.com/www/mb/images/loading.gif\"/>\n                ";
            } else {
                this.characters[i].fontSize = 10;
            }
        }

        if (hide) {
            this.personalDetail.hide();
        }
    },
    click: function click() {}
};

exports.default = draw;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var drawType = function drawType(characters, ctx) {
    this.characters = characters;
    this.ctx = ctx;
    this.width = this.ctx.canvas.width - 200;
    this.height = this.ctx.canvas.width;
};

drawType.prototype = {
    line: function line(attr, rang) {
        for (var i = 0; i < this.characters.length; i++) {
            if (i == 0) {
                this.ctx.beginPath();
                this.ctx.moveTo(this.characters[i].x, this.characters[i].y);
            } else {
                this.ctx.beginPath();
                this.ctx.moveTo(this.characters[i - 1].x, this.characters[i - 1].y);
                this.ctx.lineTo(this.characters[i].x, this.characters[i].y);
            }
            this.ctx.arc(this.characters[i].x, this.characters[i].y, this.characters[i].r, 0, 2 * Math.PI);
            this.ctx.strokeStyle = this.characters[i].color;
            this.ctx.stroke();
        }
    },
    rectangle: function rectangle(attr, rang) {
        for (var i = 0; i < this.characters.length; i++) {
            this.ctx.fillStyle = this.characters[i].color;
            var y = this.characters[i].data[attr] / rang;
            var m = this.characters[i].fontSize == 10 ? 0 : 1;
            this.ctx.save();
            this.ctx.font = this.characters[i].fontSize + "px Arial";
            this.ctx.fillRect(this.characters[i].x - 5 * m, 600 * (1 - y) + 100 - 10 * m, 20 + 10 * m, 600 * y + 10 * m);
            this.ctx.translate(this.characters[i].x, 720);
            this.ctx.rotate(Math.PI * 4 / 9);
            this.ctx.fillText(this.characters[i].data.chn_name, 0, 0);
            this.ctx.restore();
            this.ctx.font = "10px Arial";
            this.ctx.fillStyle = "hsla(0,0%,0%,1)";
            this.ctx.fillText(this.characters[i].data[attr], this.characters[i].x - 10, 600 * (1 - y) + 100);
        }
    },
    timg: function timg(attr, rang) {},
    test: function test() {
        for (var i = 0; i < this.characters.length; i++) {
            this.ctx.fillStyle = "hsla(" + i * 360 / this.characters.length + ",80%,50%,1)";
            this.ctx.fillText(this.characters[i].data.chn_name + ":" + this.characters[i].data.ballot_sum + "\u7968", 0, (i + 0.25) * 40 + 800);
            this.ctx.fillText("\u6709" + this.characters[i].data.real_love_num + "\u4EBA\u548C\u4F60\u62A2\u8001\u5A46", 0, (i + 0.75) * 40 + 800);
        }
    }
};

exports.default = drawType;

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var personalDetail = function personalDetail() {
    this.personal = document.createElement("div");
    document.body.appendChild(this.personal);
    //0:display,1:position,2:width,3:height,4:top,5:left,
    this.style = ["none", "absolute", 250, 400, 0, 0];
    this.personal.style = "\n    display:" + this.style[0] + ";\n    position:" + this.style[1] + ";\n    width:" + this.style[2] + "px;\n    height:" + this.style[3] + "px;\n    top:" + this.style[4] + ";\n    background-color:hsla(1,100%,100%,1);\n    left:" + this.style[5] + ";";
};

personalDetail.prototype = {
    show: function show(e) {
        this.style[0] = "block";
        this.style[4] = e.offsetY + 70 > document.body.scrollTop ? e.offsetY + 70 : document.body.scrollTop;
        this.style[5] = e.offsetX + this.style[2] > window.innerWidth ? window.innerWidth - this.style[2] + 15 : e.clientX + 15;
        this.personal.style = "\n        display:" + this.style[0] + ";\n        position:" + this.style[1] + ";\n        width:" + this.style[2] + "px;\n        height:" + this.style[3] + "px;\n        top:" + this.style[4] + ";\n        background-color:hsla(1,100%,100%,1);\n        left:" + this.style[5] + ";";
    },
    hide: function hide() {
        this.style[0] = "none";
        this.personal.style = "\n        display:" + this.style[0] + ";\n        position:" + this.style[1] + ";\n        width:" + this.style[2] + "px;\n        height:" + this.style[3] + "px;\n        top:" + this.style[4] + ";\n        background-color:hsla(1,100%,100%,1);\n        left:" + this.style[5] + ";";
    }
};

exports.default = personalDetail;

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var personal = function personal(data, x, y, r, color) {
    this.data = data;
    this.x = x;
    this.y = y;
    this.r = r;
    this.fontSize = 10;
    this.color = color;
};

exports.default = personal;

/***/ })
/******/ ]);